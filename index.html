<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ€ç»´å†’é™©è€… Â· æ‰¹åˆ¤æ€§æ€ç»´è®­ç»ƒå°æ¸¸æˆ</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- ===== ç¾ä¸½ UI çš„ CSS ===== -->
<style>
    body {
        margin: 0;
        font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        background: linear-gradient(135deg, #dbeafe, #fef3c7);
        min-height: 100vh;
    }

    /* é¡¶éƒ¨æ ‡é¢˜æ  */
    header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 18px 0;
        background: #1e293b;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    header img {
        height: 48px;
        border-radius: 8px;
    }

    header span {
        color: white;
        font-size: 20px;
        font-weight: bold;
    }

    /* å¡ç‰‡æ•´ä½“å®¹å™¨ */
    .container {
        max-width: 760px;
        margin: 0 auto;
        padding: 20px;
    }

    /* æœ€æ¼‚äº®çš„å¡ç‰‡å¡ç‰‡ï¼ï¼ */
    .card {
        background: rgba(255,255,255,0.65);
        backdrop-filter: blur(14px);
        padding: 20px;
        border-radius: 18px;
        box-shadow: 0 10px 35px rgba(0,0,0,0.1);
        margin-bottom: 26px;
        border: 1px solid rgba(255,255,255,0.4);
    }

    .section-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 12px;
        color: #1e293b;
    }

    button {
        background: #3b82f6;
        border: none;
        padding: 12px 16px;
        border-radius: 10px;
        font-size: 15px;
        color: white;
        cursor: pointer;
        transition: 0.2s;
    }
    button:hover {
        background: #2563eb;
    }

    textarea {
        width: 100%;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid #cbd5e1;
        font-size: 15px;
        box-sizing: border-box;
        background: white;
        margin-top: 10px;
        min-height:140px;
    }

    select {
        width: 100%;
        padding: 10px;
        border-radius: 10px;
        font-size: 15px;
        border: 1px solid #cbd5e1;
        margin-bottom: 10px;
    }

    canvas {
        max-width: 100%;
    }

    /* ç­‰çº§æ˜¾ç¤ºå¡ç‰‡ */
    #level-card {
        background: white;
        border-radius: 16px;
        padding: 18px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        margin: 15px 0 30px 0;
    }

    #level-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 6px;
        color:#1e293b;
    }

    #percentile-text {
        margin-top: 6px;
        font-size: 14px;
        color:#475569;
    }

    /* ç­‰çº§è¿›åº¦æ¡ */
    .progress-bg {
        height: 12px;
        background: #e2e8f0;
        border-radius: 6px;
        margin-top: 8px;
        overflow: hidden;
    }
    #progress-bar {
        height: 12px;
        background: linear-gradient(90deg,#60a5fa,#2563eb);
        width: 0%;
        transition: width 0.5s ease;
    }
</style>
</head>

<body>

<!-- LOGO Header -->
<header>
    <img src="ChatGPT Image 2025å¹´11æœˆ17æ—¥ 17_47_21.png" alt="logo">
    <span>æ€ç»´å†’é™©è€… Â· æ‰¹åˆ¤æ€§æ€ç»´è®­ç»ƒå°æ¸¸æˆ</span>
</header>

<!-- ç­‰çº§ç³»ç»Ÿå¡ç‰‡ -->
<div class="container">
<div id="level-card">
    <div id="level-title">ç­‰çº§ï¼šåŠ è½½ä¸­...</div>
    <div class="progress-bg">
        <div id="progress-bar"></div>
    </div>
    <div id="level-exp-text" style="margin-top:6px; color:#475569;">ç§¯åˆ†ï¼š0</div>
    <div id="percentile-text">ä½ è¶…è¿‡äº†å…¨çƒ 0% çš„äººç±»</div>
</div>
</div>

<!-- ä¸»ä½“å†…å®¹ -->
<div class="container">

    <div class="card">
        <div class="section-title">â‘  æŠ½å–ä»Šæ—¥æ€ç»´å…ƒç´ å¡</div>
        <button onclick="drawElementCard()">æŠ½å…ƒç´ å¡</button>
        <p id="elementCard" style="white-space:pre-wrap;"></p>
        <textarea id="elementAnswer" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„å›ç­”..."></textarea>
    </div>

    <div class="card">
        <div class="section-title">â‘¡ æŠ½å–ä»Šæ—¥æ€ç»´æ ‡å‡†å¡</div>
        <button onclick="drawStandardCard()">æŠ½æ ‡å‡†å¡</button>
        <p id="standardCard" style="white-space:pre-wrap;"></p>

        <div class="section-title">ä¸ºè¯¥æ ‡å‡†æ‰“åˆ†ï¼ˆ1â€“3 åˆ†ï¼‰</div>
        <select id="standardScore">
            <option value="1">1 åˆ†</option>
            <option value="2">2 åˆ†</option>
            <option value="3">3 åˆ†</option>
        </select>

        <div class="section-title">è¯šå®åº¦æ‰“åˆ†ï¼ˆ1â€“3 åˆ†ï¼‰</div>
        <select id="honestyScore">
            <option value="1">1 åˆ†</option>
            <option value="2">2 åˆ†</option>
            <option value="3">3 åˆ†</option>
        </select>
    </div>

    <button onclick="saveToday()">ä¿å­˜ä»Šæ—¥è®°å½•</button>

    <div class="card">
        <div class="section-title">â‘¢ æœ¬å‘¨ç»Ÿè®¡ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰</div>
        <pre id="weeklyStats"></pre>
        <button onclick="showWeekly()">åˆ·æ–°ç»Ÿè®¡ & å›¾è¡¨</button>
    </div>

    <div class="card">
        <div class="section-title">ğŸ“Š æ€ç»´è¦ç´ ç»ƒä¹ è¦†ç›–åº¦</div>
        <canvas id="elementRadar"></canvas>
    </div>

    <div class="card">
        <div class="section-title">ğŸ“Š æ€ç»´æ ‡å‡†å¹³å‡åˆ†</div>
        <canvas id="standardRadar"></canvas>
    </div>

    <div class="card">
        <div class="section-title">ğŸ“ˆ æ€ç»´é˜¶æ®µè¶‹åŠ¿</div>
        <canvas id="stageTrend"></canvas>
    </div>

</div>

<!-- ================= JS ================= -->
<script>
/********** å…ƒç´ å¡ **********/
const elementCards = [
    {key:"ç›®çš„", text:"ã€ç›®çš„å¡ã€‘ä½ çš„çœŸæ­£ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿè¡¨é¢ç›®çš„æ˜¯ï¼Ÿ"},
    {key:"é—®é¢˜", text:"ã€é—®é¢˜å¡ã€‘æŠŠä½ çº ç»“çš„ä¸€ä»¶äº‹ï¼Œæ”¹å†™æˆä¸€ä¸ªæ¸…æ™°çš„é—®é¢˜å¥ã€‚"},
    {key:"ä¿¡æ¯", text:"ã€ä¿¡æ¯å¡ã€‘å†™å‡ºè¯¥é—®é¢˜ï¼š3 ä¸ªäº‹å® + 3 ä¸ªçŒœæµ‹"},
    {key:"æ¦‚å¿µ", text:"ã€æ¦‚å¿µå¡ã€‘é€‰ä¸€ä¸ªæŠ½è±¡è¯ï¼ˆå¦‚è‡ªç”±/å®‰å…¨ï¼‰ï¼Œå†™ä¸‹ä½ çš„å®šä¹‰ã€‚"},
    {key:"æ¨è®º", text:"ã€æ¨è®ºå¡ã€‘å†™ä¸€ä¸ªç»“è®ºï¼Œå¹¶åˆ—å‡ºæ”¯æ’‘ç†ç”±ã€‚"},
    {key:"å‡è®¾", text:"ã€å‡è®¾å¡ã€‘ä½ çš„é»˜è®¤å‡è®¾æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœè¿™æ˜¯é”™çš„å‘¢ï¼Ÿ"},
    {key:"è§†è§’", text:"ã€è§†è§’å¡ã€‘ä»å¯¹ç«‹é¢è§†è§’å†™ 2 å¥è¯ã€‚"},
    {key:"åæœ", text:"ã€åæœå¡ã€‘å†™å‡ºä¸€ä¸ªå†³å®šçš„çŸ­æœŸ + é•¿æœŸåæœã€‚"},
];

/********** æ ‡å‡†å¡ **********/
const standardCards = [
    {key:"æ¸…æ™°", text:"ã€æ¸…æ™°å¡ã€‘ä½ çš„è¡¨è¾¾æ˜¯å¦è®©é™Œç”Ÿäººèƒ½ç†è§£ï¼Ÿ"},
    {key:"å‡†ç¡®", text:"ã€å‡†ç¡®å¡ã€‘å“ªäº›æ˜¯äº‹å®ï¼Ÿå“ªäº›å¯èƒ½é”™è¯¯ï¼Ÿ"},
    {key:"ç²¾ç¡®", text:"ã€ç²¾ç¡®å¡ã€‘å¯ä»¥æ›´å…·ä½“å—ï¼Ÿ"},
    {key:"ç›¸å…³", text:"ã€ç›¸å…³å¡ã€‘æ¯å¥è¯éƒ½ç´§æ‰£æ ¸å¿ƒé—®é¢˜å—ï¼Ÿ"},
    {key:"æ·±åˆ»", text:"ã€æ·±åˆ»å¡ã€‘ä½ è§¦åˆ°é—®é¢˜çš„éš¾ç‚¹äº†å—ï¼Ÿ"},
    {key:"å¹¿åº¦", text:"ã€å¹¿åº¦å¡ã€‘å¦‚æœå¿…é¡»ç«™åæ–¹ï¼Œä½ ä¼šæ€ä¹ˆå†™ï¼Ÿ"},
    {key:"é€»è¾‘", text:"ã€é€»è¾‘å¡ã€‘ç†ç”±ä¸ç»“è®ºä¸€è‡´å—ï¼Ÿ"},
    {key:"é‡è¦æ€§", text:"ã€é‡è¦æ€§å¡ã€‘ä½ å…³æ³¨çš„æ˜¯æœ€å…³é”®ä¹‹å¤„å—ï¼Ÿ"},
    {key:"å…¬æ­£", text:"ã€å…¬æ­£å¡ã€‘ä½ æ˜¯å¦å¯¹è‡ªå·±å’Œä»–äººç”¨åŒä¸€æ ‡å‡†ï¼Ÿ"},
];

/********** æŠ½å¡å‡½æ•° **********/
function drawElementCard() {
    const c = elementCards[Math.floor(Math.random()*elementCards.length)];
    document.getElementById("elementCard").innerText = c.text;
    localStorage.setItem("today_element", JSON.stringify(c));
}
function drawStandardCard() {
    const c = standardCards[Math.floor(Math.random()*standardCards.length)];
    document.getElementById("standardCard").innerText = c.text;
    localStorage.setItem("today_standard", JSON.stringify(c));
}

/********** ç­‰çº§ç³»ç»Ÿé…ç½® **********/
const LEVELS = [
    { level: 1, name: "æ€ç»´èŒèŠ½ Seedling", min: 0, max: 99, percentile: 20 },
    { level: 2, name: "æ€ç»´è§‚å¯Ÿè€… Observer", min: 100, max: 249, percentile: 35 },
    { level: 3, name: "æ€ç»´æ¢ç´¢è€… Explorer", min: 250, max: 499, percentile: 50 },
    { level: 4, name: "æ€ç»´å®è·µè€… Practitioner", min: 500, max: 899, percentile: 70 },
    { level: 5, name: "æ€ç»´ç­–å£« Strategist", min: 900, max: 1499, percentile: 85 },
    { level: 6, name: "æ€ç»´é©¾é©­è€… Navigator", min: 1500, max: 2499, percentile: 95 },
    { level: 7, name: "æ€ç»´å¤§å¸ˆ Master", min: 2500, max: 999999, percentile: 99 },
];

// æ¯æ—¥ EXP
function calculateEXP(r){ return (r.standardScore + r.honestyScore) * 5; }
function getTotalEXP(logs){ return logs.reduce((a,r)=>a+calculateEXP(r),0); }
function getLevel(total){ return LEVELS.find(l=>total>=l.min && total<=l.max); }
function getNextEXP(lv){ return lv.level==7? lv.max : LEVELS[lv.level].min; }

/********** ä¿å­˜è®°å½• **********/
function saveToday(){
    const e = JSON.parse(localStorage.getItem("today_element"));
    const s = JSON.parse(localStorage.getItem("today_standard"));
    if(!e||!s){ alert("è¯·å…ˆæŠ½å¡ï¼"); return; }

    const text=document.getElementById("elementAnswer").value.trim();
    const rec={
        date:new Date().toISOString().slice(0,10),
        element:e.key,
        standard:s.key,
        text,
        standardScore:parseInt(document.getElementById("standardScore").value),
        honestyScore:parseInt(document.getElementById("honestyScore").value)
    };
    let logs=JSON.parse(localStorage.getItem("logs")||"[]");
    logs.push(rec);
    localStorage.setItem("logs",JSON.stringify(logs));

    alert("å·²ä¿å­˜ï¼");
    updateLevelUI();
}

/********** æ›´æ–°ç­‰çº§ UI **********/
function updateLevelUI(){
    const logs=JSON.parse(localStorage.getItem("logs")||"[]");
    const total=getTotalEXP(logs);
    const lv=getLevel(total);
    const next=getNextEXP(lv);
    const pct = Math.min((total-lv.min)/(next-lv.min),1)*100;

    document.getElementById("level-title").innerText=`ç­‰çº§ Lv.${lv.level}ï¼š${lv.name}`;
    document.getElementById("level-exp-text").innerText=`ç§¯åˆ†ï¼š${total} / ${next}`;
    document.getElementById("progress-bar").style.width = pct+"%";
    document.getElementById("percentile-text").innerText =
        `ä½ çš„æ€ç»´æ°´å¹³è¶…è¿‡äº†å…¨çƒ ${lv.percentile}% çš„äººç±»`;
}

/********** å›¾è¡¨ **********/
let elementRadarChart,standardRadarChart,stageTrendChart;

function calcElementFrequency(logs){
    const keys=["ç›®çš„","é—®é¢˜","ä¿¡æ¯","æ¦‚å¿µ","æ¨è®º","å‡è®¾","è§†è§’","åæœ"];
    return {labels:keys,data:keys.map(k=>logs.filter(r=>r.element==k).length)};
}
function calcStandardScores(logs){
    const keys=["æ¸…æ™°","å‡†ç¡®","ç²¾ç¡®","ç›¸å…³","æ·±åˆ»","å¹¿åº¦","é€»è¾‘","é‡è¦æ€§","å…¬æ­£"];
    return {labels:keys,data:keys.map(k=>{
        const l=logs.filter(r=>r.standard==k);
        return l.length? l.reduce((a,b)=>a+b.standardScore,0)/l.length : 0;
    })};
}
function calcStageTrend(logs){
    logs=[...logs].sort((a,b)=>new Date(a.date)-new Date(b.date));
    return {
        labels:logs.map(r=>r.date),
        values:logs.map(r=>{
            const sc=(r.standardScore+r.honestyScore)/2;
            if(sc<2) return 1;
            if(sc<2.5) return 2;
            return 3;
        })
    };
}

function showWeekly(){
    const logs=JSON.parse(localStorage.getItem("logs")||"[]");
    const now=Date.now(),week=7*24*3600*1000;
    const weekLogs=logs.filter(r=>now-new Date(r.date).getTime()<week);
    const el=document.getElementById("weeklyStats");

    if(!weekLogs.length){
        el.innerText="æœ¬å‘¨è¿˜æ²¡æœ‰è®°å½•";
        renderCharts(logs);
        return;
    }

    const avg=(arr,key)=>arr.reduce((a,b)=>a+b[key],0)/arr.length;

    el.innerText=
        `æœ¬å‘¨ç»ƒä¹ æ¬¡æ•°ï¼š${weekLogs.length}\n`+
        `å¹³å‡æ ‡å‡†å¾—åˆ†ï¼š${avg(weekLogs,"standardScore").toFixed(2)}\n`+
        `å¹³å‡è¯šå®åº¦ï¼š${avg(weekLogs,"honestyScore").toFixed(2)}\n`+
        `è¦†ç›–è¦ç´ ï¼š${[...new Set(weekLogs.map(r=>r.element))].join("ï¼Œ")}\n`+
        `è¦†ç›–æ ‡å‡†ï¼š${[...new Set(weekLogs.map(r=>r.standard))].join("ï¼Œ")}`;

    renderCharts(logs);
}

function renderCharts(logs){
    const e=calcElementFrequency(logs);
    const s=calcStandardScores(logs);
    const st=calcStageTrend(logs);

    if(elementRadarChart) elementRadarChart.destroy();
    if(standardRadarChart) standardRadarChart.destroy();
    if(stageTrendChart) stageTrendChart.destroy();

    elementRadarChart=new Chart(document.getElementById("elementRadar"),{
        type:'radar',
        data:{labels:e.labels,datasets:[{label:"ç»ƒä¹ æ¬¡æ•°",data:e.data,
            borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,0.25)"}]}
    });

    standardRadarChart=new Chart(document.getElementById("standardRadar"),{
        type:'radar',
        data:{labels:s.labels,datasets:[{label:"å¹³å‡åˆ†",data:s.data,
            borderColor:"#ef4444",backgroundColor:"rgba(239,68,68,0.25)"}]}
    });

    stageTrendChart=new Chart(document.getElementById("stageTrend"),{
        type:'line',
        data:{labels:st.labels,datasets:[{label:"é˜¶æ®µè¶‹åŠ¿(1æŒ£æ‰/2åˆå­¦/3ç»ƒä¹ )",
            data:st.values,borderColor:"#10b981",tension:0.3}]},
        options:{scales:{y:{min:1,max:3,stepSize:1}}}
    });
}

/* ç½‘é¡µåŠ è½½æ—¶æ›´æ–°ç­‰çº§ */
updateLevelUI();
</script>

</body>
</html>
