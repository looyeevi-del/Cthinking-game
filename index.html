<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>æ€ç»´å†’é™©è€… Â· æ€ç»´è®­ç»ƒå°æ¸¸æˆ</title>

<!-- å¼•å…¥ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- ====== STYLE ====== -->
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
        background: #f8f8f8;
    }

    header {
        display:flex;
        align-items:center;
        justify-content:center;
        gap:12px;
        padding: 15px 0;
        background:#222;
    }

    header img {
        height:48px;
        width:auto;
        border-radius:8px;
    }

    header span {
        font-size:20px;
        color:white;
    }

    .container {
        padding: 20px;
        max-width: 680px;
        margin: 0 auto;
    }

    button {
        padding: 12px 18px;
        border: none;
        background: #3a5dd0;
        color: white;
        font-size: 15px;
        border-radius: 6px;
        cursor: pointer;
        margin: 10px 0;
    }

    button:hover {
        opacity: 0.9;
    }

    textarea {
        width: 100%;
        padding: 10px;
        min-height: 130px;
        margin-top: 10px;
        font-size: 15px;
        border-radius: 6px;
        border: 1px solid #ddd;
        box-sizing: border-box;
    }

    .card {
        padding: 16px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        margin-bottom: 20px;
    }

    .section-title {
        font-size: 17px;
        margin-top: 5px;
        margin-bottom: 10px;
        font-weight: bold;
    }

    select {
        padding: 8px;
        border-radius: 6px;
        font-size: 15px;
        border: 1px solid #ddd;
    }

    #weeklyStats {
        white-space: pre-wrap;
        font-size: 14px;
        line-height: 1.6;
    }

    canvas {
        max-width: 100%;
    }
</style>
</head>

<body>

<!-- ====== HEADERï¼ˆå« LOGOï¼‰ ====== -->
<header>
    <img src="ChatGPT Image 2025å¹´11æœˆ17æ—¥ 17_47_21.png" alt="logo">
    <span>æ€ç»´å†’é™©è€… Â· æ‰¹åˆ¤æ€§æ€ç»´è®­ç»ƒå°æ¸¸æˆ</span>
</header>

<div class="container">

    <!-- æŠ½å¡åŒºï¼šæ€ç»´è¦ç´  -->
    <div class="card">
        <div class="section-title">â‘  æŠ½å–ä»Šæ—¥æ€ç»´å…ƒç´ å¡</div>
        <button onclick="drawElementCard()">æŠ½å…ƒç´ å¡</button>
        <p id="elementCard" style="font-size:16px; white-space:pre-wrap;"></p>

        <textarea id="elementAnswer" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„å›ç­”..."></textarea>
    </div>

    <!-- æŠ½å¡åŒºï¼šæ€ç»´æ ‡å‡† -->
    <div class="card">
        <div class="section-title">â‘¡ æŠ½å–ä»Šæ—¥æ€ç»´æ ‡å‡†å¡</div>
        <button onclick="drawStandardCard()">æŠ½æ ‡å‡†å¡</button>
        <p id="standardCard" style="font-size:16px; white-space:pre-wrap;"></p>

        <div class="section-title">ä¸ºè¯¥æ ‡å‡†æ‰“åˆ†ï¼ˆ1â€“3 åˆ†ï¼‰</div>
        <select id="standardScore">
            <option value="1">1 åˆ†</option>
            <option value="2">2 åˆ†</option>
            <option value="3">3 åˆ†</option>
        </select>

        <div class="section-title">è¯šå®åº¦æ‰“åˆ†ï¼ˆ1â€“3 åˆ†ï¼‰</div>
        <select id="honestyScore">
            <option value="1">1 åˆ†</option>
            <option value="2">2 åˆ†</option>
            <option value="3">3 åˆ†</option>
        </select>
    </div>

    <button onclick="saveToday()">ä¿å­˜ä»Šæ—¥è®°å½•</button>

    <!-- å‘¨ç»Ÿè®¡ -->
    <div class="card">
        <div class="section-title">â‘¢ æœ¬å‘¨ç»Ÿè®¡ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰</div>
        <p id="weeklyStats"></p>
        <button onclick="showWeekly()">åˆ·æ–°ç»Ÿè®¡ & å›¾è¡¨</button>
    </div>

    <!-- å›¾è¡¨ï¼šå…«è¦ç´ é›·è¾¾ -->
    <div class="card">
        <div class="section-title">ğŸ“Š æ€ç»´è¦ç´ ç»ƒä¹ è¦†ç›–åº¦ï¼ˆé›·è¾¾å›¾ï¼‰</div>
        <canvas id="elementRadar"></canvas>
    </div>

    <!-- å›¾è¡¨ï¼šä¹æ ‡å‡†é›·è¾¾ -->
    <div class="card">
        <div class="section-title">ğŸ“Š æ€ç»´æ ‡å‡†å¹³å‡åˆ†ï¼ˆé›·è¾¾å›¾ï¼‰</div>
        <canvas id="standardRadar"></canvas>
    </div>

    <!-- å›¾è¡¨ï¼šé˜¶æ®µè¶‹åŠ¿æŠ˜çº¿ -->
    <div class="card">
        <div class="section-title">ğŸ“ˆ æ€ç»´é˜¶æ®µè¶‹åŠ¿ï¼ˆæŠ˜çº¿å›¾ï¼‰</div>
        <canvas id="stageTrend"></canvas>
    </div>

</div>

<!-- ====== SCRIPT ====== -->
<script>
/* ---- å…ƒç´ å¡ ---- */
const elementCards = [
    {key:"ç›®çš„", text:"ã€ç›®çš„å¡ã€‘å†™ä¸‹ä½ æ­£åœ¨å…³æ³¨çš„ä¸€ä»¶äº‹ï¼šä½ çš„çœŸæ­£ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿè¡¨é¢ç›®çš„æ˜¯ï¼Ÿ"},
    {key:"é—®é¢˜", text:"ã€é—®é¢˜å¡ã€‘æŠŠä½ æ­£åœ¨çº ç»“çš„ä¸€ä»¶äº‹ï¼Œæ”¹å†™æˆä¸€ä¸ªæ¸…æ™°çš„é—®é¢˜å¥ã€‚"},
    {key:"ä¿¡æ¯", text:"ã€ä¿¡æ¯å¡ã€‘å†™å‡ºä¸è¯¥é—®é¢˜ç›¸å…³çš„ï¼š3 ä¸ªäº‹å® + 3 ä¸ªçŒœæµ‹ï¼Œå¹¶æ ‡æ¸…ã€‚"},
    {key:"æ¦‚å¿µ", text:"ã€æ¦‚å¿µå¡ã€‘é€‰ä¸€ä¸ªæŠ½è±¡è¯ï¼ˆå¦‚è‡ªç”±/æˆåŠŸ/å®‰å…¨ï¼‰ï¼Œå†™å‡ºä½ ç°åœ¨çš„å®šä¹‰ã€‚"},
    {key:"æ¨è®º", text:"ã€æ¨è®ºå¡ã€‘å†™ä¸€ä¸ªä½ æœ€è¿‘å¾—å‡ºçš„ç»“è®ºï¼Œå¹¶åˆ—å‡º 2â€“3 ä¸ªæ”¯æŒå®ƒçš„ç†ç”±ã€‚"},
    {key:"å‡è®¾", text:"ã€å‡è®¾å¡ã€‘å†™å‡ºä½ åœ¨è¿™ä¸ªè¯é¢˜ä¸­çš„â€œæƒ³å½“ç„¶â€å‡è®¾ï¼Œå¹¶é—®ï¼šå¦‚æœè¿™æ˜¯é”™çš„å‘¢ï¼Ÿ"},
    {key:"è§†è§’", text:"ã€è§†è§’å¡ã€‘ä»ä¸ä½ ç«‹åœºç›¸åçš„äººçš„è§†è§’ï¼Œå†™ 2 å¥è¯çœ‹å¾…åŒä¸€ä»¶äº‹ã€‚"},
    {key:"åæœ", text:"ã€åæœå¡ã€‘å†™å‡ºä½ æŸä¸ªå†³å®šçš„ï¼š1 ä¸ªçŸ­æœŸåæœ + 1 ä¸ªé•¿æœŸåæœã€‚"},
];

/* ---- æ ‡å‡†å¡ ---- */
const standardCards = [
    {key:"æ¸…æ™°", text:"ã€æ¸…æ™°å¡ã€‘ä½ çš„è¡¨è¾¾æ˜¯å¦è®©é™Œç”Ÿäººä¹Ÿèƒ½å‡†ç¡®ç†è§£ï¼Ÿ"},
    {key:"å‡†ç¡®", text:"ã€å‡†ç¡®å¡ã€‘å“ªäº›å†…å®¹æ˜¯å¯éªŒè¯çš„äº‹å®ï¼Ÿæœ‰æ²¡æœ‰å¯èƒ½é”™çš„åœ°æ–¹ï¼Ÿ"},
    {key:"ç²¾ç¡®", text:"ã€ç²¾ç¡®å¡ã€‘æ˜¯å¦å¯ä»¥ç”¨æ›´å…·ä½“çš„æ•°å­—ã€ä¾‹å­æˆ–æƒ…å¢ƒæ¥è¯´æ˜ï¼Ÿ"},
    {key:"ç›¸å…³", text:"ã€ç›¸å…³å¡ã€‘ä½ å†™çš„æ¯ä¸€å¥è¯ï¼Œéƒ½ç´§æ‰£åŒä¸€ä¸ªæ ¸å¿ƒé—®é¢˜å—ï¼Ÿ"},
    {key:"æ·±åˆ»", text:"ã€æ·±åˆ»å¡ã€‘ä½ æ˜¯å¦è§¦åˆ°è¿™ä»¶äº‹æ›´æ·±ä¸€å±‚çš„çŸ›ç›¾æˆ–å›°éš¾ï¼Ÿ"},
    {key:"å¹¿åº¦", text:"ã€å¹¿åº¦å¡ã€‘å¦‚æœä½ å¿…é¡»ç«™åœ¨ç›¸åç«‹åœºæ€è€ƒï¼Œä¼šæ€ä¹ˆé‡å†™ï¼Ÿ"},
    {key:"é€»è¾‘", text:"ã€é€»è¾‘å¡ã€‘ä½ çš„ç†ç”±å’Œç»“è®ºä¹‹é—´æ˜¯å¦å‰åä¸€è‡´ã€æ²¡æœ‰çŸ›ç›¾ï¼Ÿ"},
    {key:"é‡è¦æ€§", text:"ã€é‡è¦æ€§å¡ã€‘ä½ å…³æ³¨çš„æ˜¯æœ€å…³é”®çš„éƒ¨åˆ†ï¼Œè¿˜æ˜¯ä¸€äº›æèŠ‚ï¼Ÿ"},
    {key:"å…¬æ­£", text:"ã€å…¬æ­£å¡ã€‘ä½ æ˜¯å¦ç”¨åŒæ ·æ ‡å‡†è¯„åˆ¤è‡ªå·±å’Œä»–äººï¼Ÿ"},
];

/* ---- æŠ½å¡ ---- */
function drawElementCard() {
    const card = elementCards[Math.floor(Math.random()*elementCards.length)];
    document.getElementById("elementCard").innerText = card.text;
    localStorage.setItem("today_element", JSON.stringify(card));
}

function drawStandardCard() {
    const card = standardCards[Math.floor(Math.random()*standardCards.length)];
    document.getElementById("standardCard").innerText = card.text;
    localStorage.setItem("today_standard", JSON.stringify(card));
}

/* ---- ä¿å­˜ ---- */
function saveToday() {
    const element = JSON.parse(localStorage.getItem("today_element"));
    const standard = JSON.parse(localStorage.getItem("today_standard"));
    if(!element || !standard) {
        alert("è¯·å…ˆæŠ½å…ƒç´ å¡å’Œæ ‡å‡†å¡ï¼Œå†ä¿å­˜ã€‚");
        return;
    }

    const text = document.getElementById("elementAnswer").value.trim();
    if (!text) {
        if (!confirm("ä½ è¿˜æ²¡æœ‰å†™ä»»ä½•å†…å®¹ï¼Œç¡®å®šä¹Ÿè¦ä¿å­˜å—ï¼Ÿ")) return;
    }

    const record = {
        date: new Date().toISOString().slice(0,10),
        element: element.key,
        standard: standard.key,
        text: text,
        standardScore: parseInt(document.getElementById("standardScore").value),
        honestyScore: parseInt(document.getElementById("honestyScore").value),
    };

    let logs = JSON.parse(localStorage.getItem("logs") || "[]");
    logs.push(record);
    localStorage.setItem("logs", JSON.stringify(logs));

    alert("ä»Šæ—¥è®°å½•å·²ä¿å­˜ï¼");
}

/* ---- å‘¨ç»Ÿè®¡ ---- */
function showWeekly() {
    const logs = JSON.parse(localStorage.getItem("logs") || "[]");
    const now = Date.now();
    const oneWeek = 7 * 24 * 3600 * 1000;

    const weekLogs = logs.filter(r => now - new Date(r.date).getTime() < oneWeek);
    const weeklyStatsEl = document.getElementById("weeklyStats");

    if (weekLogs.length === 0){
        weeklyStatsEl.innerText = "æœ¬å‘¨è¿˜æ²¡æœ‰è®°å½•ã€‚å…ˆå»æŠ½ä¸€å¼ å¡è¯•è¯•å§ï½";
        renderCharts(logs);
        return;
    }

    const avg = (arr, key) => arr.reduce((a,b)=>a+b[key],0) / arr.length;

    const msg =
        `æœ¬å‘¨ç»ƒä¹ æ¬¡æ•°ï¼š${weekLogs.length}\n` +
        `å¹³å‡æ ‡å‡†å¾—åˆ†ï¼š${avg(weekLogs,"standardScore").toFixed(2)}\n` +
        `å¹³å‡è¯šå®åº¦ï¼š${avg(weekLogs,"honestyScore").toFixed(2)}\n` +
        `è¦†ç›–çš„æ€ç»´è¦ç´ ï¼š${[...new Set(weekLogs.map(r=>r.element))].join("ï¼Œ")}\n` +
        `è¦†ç›–çš„æ€ç»´æ ‡å‡†ï¼š${[...new Set(weekLogs.map(r=>r.standard))].join("ï¼Œ")}`;

    weeklyStatsEl.innerText = msg;

    renderCharts(logs);
}

/* ---- å›¾è¡¨è®¡ç®— ---- */
function calcElementFrequency(logs) {
    const elements = ["ç›®çš„","é—®é¢˜","ä¿¡æ¯","æ¦‚å¿µ","æ¨è®º","å‡è®¾","è§†è§’","åæœ"];
    const freq = elements.map(el => logs.filter(r => r.element === el).length);
    return { labels: elements, data: freq };
}

function calcStandardScores(logs) {
    const standards = ["æ¸…æ™°","å‡†ç¡®","ç²¾ç¡®","ç›¸å…³","æ·±åˆ»","å¹¿åº¦","é€»è¾‘","é‡è¦æ€§","å…¬æ­£"];
    const data = standards.map(st => {
        const filtered = logs.filter(r => r.standard === st);
        if (filtered.length === 0) return 0;
        return filtered.reduce((a,b)=>a+b.standardScore,0) / filtered.length;
    });
    return { labels: standards, data };
}

function calcStageTrend(logs) {
    const sorted = [...logs].sort((a,b)=> new Date(a.date) - new Date(b.date));
    const labels = sorted.map(r => r.date);
    const values = sorted.map(r => {
        const score = (r.standardScore + r.honestyScore) / 2;
        if (score < 2) return 1;
        if (score < 2.5) return 2;
        return 3;
    });
    return { labels, values };
}

/* ---- å›¾è¡¨æ¸²æŸ“ ---- */
let elementRadarChart = null;
let standardRadarChart = null;
let stageTrendChart = null;

function renderCharts(logs) {
    if (!logs || logs.length === 0) return;

    const elementCtx = document.getElementById("elementRadar");
    const standardCtx = document.getElementById("standardRadar");
    const stageCtx = document.getElementById("stageTrend");

    const elementData = calcElementFrequency(logs);
    const standardData = calcStandardScores(logs);
    const stageData = calcStageTrend(logs);

    if (elementRadarChart) elementRadarChart.destroy();
    if (standardRadarChart) standardRadarChart.destroy();
    if (stageTrendChart) stageTrendChart.destroy();

    elementRadarChart = new Chart(elementCtx, {
        type: 'radar',
        data: {
            labels: elementData.labels,
            datasets: [{
                label: 'ç»ƒä¹ æ¬¡æ•°',
                data: elementData.data,
                fill: true,
                borderColor: "#3a5dd0",
                backgroundColor: "rgba(58,93,208,0.2)"
            }]
        }
    });

    standardRadarChart = new Chart(standardCtx, {
        type: 'radar',
        data: {
            labels: standardData.labels,
            datasets: [{
                label: 'å¹³å‡åˆ†',
                data: standardData.data,
                fill: true,
                borderColor: "#da4453",
                backgroundColor: "rgba(218,68,83,0.2)"
            }]
        }
    });

    stageTrendChart = new Chart(stageCtx, {
        type: 'line',
        data: {
            labels: stageData.labels,
            datasets: [{
                label: "é˜¶æ®µï¼ˆ1=æŒ£æ‰ï¼Œ2=åˆå­¦ï¼Œ3=ç»ƒä¹ ï¼‰",
                data: stageData.values,
                borderColor: "#27ae60",
                pointRadius: 3,
                tension: 0.3
            }]
        },
        options: {
            scales: {
                y: {
                    min: 1,
                    max: 3,
                    ticks: { stepSize: 1 }
                }
            }
        }
    });
}
</script>

</body>
</html>
