<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ€ç»´å†’é™©è€… Â· MindVoyager</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- ===== å…¨ç«™æ ·å¼ï¼ˆNotion é£ + è›¤èŸ†å“ç‰Œï¼‰ ===== -->
<style>
:root {
    --green-main: #22c55e;
    --green-deep: #14532d;
    --green-soft: #bbf7d0;
    --bg-light: #eefbf3;
    --text-main: #0f172a;
    --text-sub: #475569;
    --radius: 20px;
    --shadow: 0 12px 40px rgba(0,0,0,0.08);
}

/* èƒŒæ™¯ */
body {
    margin:0;
    padding:0;
    font-family:"PingFang SC","Microsoft YaHei",sans-serif;
    background: var(--bg-light);
}

/* é¡¶éƒ¨æ  */
header {
    display:flex;
    align-items:center;
    gap:12px;
    padding:14px 22px;
    background:var(--green-deep);
    color:white;
}
header img {
    height:36px;
    border-radius:10px;
}
header span {
    font-size:18px;
    font-weight:600;
}

/* å®¹å™¨ */
.container {
    max-width:760px;
    margin:0 auto;
    padding:20px;
}

/* å¡ç‰‡ */
.card {
    background:white;
    border-radius:var(--radius);
    padding:22px;
    margin-bottom:26px;
    box-shadow:var(--shadow);
    position:relative;
}
.card::after {
    content:"ğŸ¸";
    position:absolute;
    top:12px;
    right:16px;
    opacity:0.85;
}
.section-title {
    font-size:18px;
    font-weight:600;
    margin-bottom:12px;
    color:var(--text-main);
}

/* æŒ‰é’® */
button {
    background:var(--green-main);
    color:white;
    border:none;
    padding:10px 16px;
    border-radius:12px;
    cursor:pointer;
    font-size:15px;
    transition:0.2s;
}
button:hover {
    background:#16a34a;
}

/* è¾“å…¥ */
textarea, select {
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:12px;
    border:1px solid #d0d7df;
    background:white;
    font-size:15px;
    box-sizing:border-box;
}

/* HERO */
.hero {
    margin-top:30px;
    text-align:center;
}
.hero img {
    width:90px;
    height:auto;
    border-radius:14px;
    margin-bottom:12px;
}
.hero-title {
    font-size:26px;
    font-weight:700;
    color:var(--green-deep);
}
.hero-sub {
    margin-top:10px;
    font-size:15px;
    color:var(--text-main);
    line-height:1.7;
}

/* ç¿»ç‰ŒåŠ¨ç”» */
.flip-card { perspective:1000px; width:100%; margin-top:16px; }
.flip-card-inner { transition:0.6s; transform-style:preserve-3d; border-radius:16px; }
.flip-card.flip .flip-card-inner { transform:rotateY(180deg); }

.flip-front, .flip-back {
    backface-visibility:hidden;
    border-radius:16px;
    border:1px solid #e5e7eb;
    padding:16px;
    min-height:80px;
    background:#fafafa;
    box-shadow:0 4px 10px rgba(0,0,0,0.04);
}
.flip-back {
    background:white;
    transform:rotateY(180deg);
}

/* å¤§å¸ˆå¡ç‰‡ */
.master-card {
    background:white;
    border-radius:var(--radius);
    padding:20px;
    cursor:pointer;
    box-shadow:var(--shadow);
    margin-bottom:26px;
}
.master-header {
    display:flex;
    align-items:center;
    justify-content:space-between;
}
.master-title { font-size:18px; font-weight:600; }
.master-arrow { transition:0.3s; font-size:20px; }
.master-content { display:none; margin-top:18px; line-height:1.65; color:var(--text-main); }

.master-section-title { font-size:16px; font-weight:600; margin:10px 0; color:#14532d; }

.master-pill {
    background:var(--green-soft);
    color:#166534;
    padding:6px 10px;
    border-radius:12px;
    display:inline-block;
    margin:6px 6px 0 0;
    font-size:14px;
}

.master-grid {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
}
.master-grid-item {
    background:#f0fdf4;
    padding:12px;
    border-radius:12px;
    font-size:14px;
    box-shadow:0 2px 10px rgba(0,0,0,0.05);
}
.master-summary {
    margin-top:10px;
    background:#fef9c3;
    border-radius:12px;
    padding:12px;
    font-size:14px;
    color:#92400e;
}

/* æ€ç»´åŠ¨ç”» */
.thinking-flow { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
.thinking-step {
    padding:6px 10px;
    border-radius:10px;
    background:#d1fae5;
    color:#166534;
    opacity:0.4;
    transition:0.3s;
}
.thinking-step.active {
    background:#22c55e;
    opacity:1;
    color:white;
    transform:scale(1.06);
}
</style>
</head>

<body>

<header>
    <!-- è¿™é‡Œç”¨ä½ ä»“åº“é‡Œçš„è›¤èŸ† logoï¼Œå¦‚æœæ²¡æœ‰å°±å…ˆç”¨æ€è€ƒçš„è›¤èŸ†.png -->
    <img src="æ€è€ƒçš„è›¤èŸ†.png" alt="logo">
    <span>æ€ç»´å†’é™©è€… Â· MindVoyager</span>
</header>

<!-- HERO -->
<div class="hero">
    <img src="æ€è€ƒçš„è›¤èŸ†.png" alt="æ€è€ƒçš„è›¤èŸ†">
    <div class="hero-title">æ€ç»´å†’é™©è€… Â· MindVoyager</div>
    <div class="hero-sub">
        æ¬¢è¿å›åˆ°ä½ çš„æ€ç»´å®‡å®™ã€‚<br>
        æ¯ä¸€æ¬¡æ€è€ƒï¼Œéƒ½æ˜¯ä¸€æ¬¡æ—…è¡Œã€‚<br>
        ä½ çš„å¤§è„‘æ¯”ä½ æƒ³è±¡çš„è¾½é˜”ã€‚<br>
        è®°å½•ï¼Œæ˜¯æ¢ç´¢è‡ªå·±çš„ç¬¬ä¸€æ­¥ã€‚
    </div>
</div>

<!-- ğŸŒŒ æ€ç»´æ˜Ÿå›¾å…¥å£ -->
<div class="container">
  <div class="card" style="border-left:6px solid var(--green-main);">
      <div class="section-title">ğŸŒŒ æˆ‘çš„æ€ç»´æ˜Ÿå›¾</div>
      <p style="font-size:14px; color:var(--text-sub); line-height:1.7;">
          è¿™é‡Œæ˜¯ä½ çš„<b>æ€ç»´å®‡å®™åœ°å›¾</b>ã€‚ç³»ç»Ÿä¼šæ ¹æ®ä½ å†™ä¸‹çš„å†…å®¹ï¼Œè‡ªåŠ¨ç”Ÿæˆã€Œå…³é”®è¯æ˜Ÿå›¾ã€ã€‚<br><br>
          ğŸŸ¢ èŠ‚ç‚¹è¶Šå¤§ â†’ è¶Šå¸¸å‡ºç°<br>
          ğŸŸ¢ èŠ‚ç‚¹è¶Šè¿‘ â†’ å…³ç³»è¶Šç´§å¯†<br>
          ğŸŸ¢ è¿çº¿ â†’ æ€ç»´ä¹‹é—´çš„çœŸå®è·¯å¾„<br><br>
          ç‚¹å‡»è¿›å…¥ï¼Œæ¢ç´¢ä½ å¤§è„‘çš„æ˜Ÿè¾°ä½“ç³» ğŸ¸âœ¨
      </p>
      <button onclick="window.location.href='mind-map.html'"
              style="margin-top:14px; border-radius:12px;">
          âœ¨ è¿›å…¥æˆ‘çš„æ€ç»´å®‡å®™
      </button>
  </div>
</div>

<!-- ğŸ§¬ ç­‰çº§ç³»ç»Ÿ -->
<div class="container">
  <div id="level-card" class="card" style="border-left:6px solid var(--green-main); padding:24px;">
      <div class="section-title">ğŸ§¬ å½“å‰ç­‰çº§</div>
      <div id="level-title" style="font-size:16px; color:var(--green-deep); font-weight:600; margin-bottom:8px;">
          ç­‰çº§ï¼šåŠ è½½ä¸­...
      </div>
      <div style="background:#e0f2e9; height:12px; border-radius:6px; margin:10px 0;">
          <div id="progress-bar"
               style="height:12px; width:0%; background:linear-gradient(90deg,#4ade80,#22c55e); border-radius:6px;">
          </div>
      </div>
      <div id="level-exp-text" style="font-size:14px; color:var(--text-sub); margin-top:6px;">
          ç§¯åˆ†ï¼š0
      </div>
      <div id="percentile-text" style="font-size:14px; color:var(--text-sub); margin-top:4px;">
          ä½ è¶…è¿‡äº†å…¨çƒ 0% çš„äººç±»
      </div>
  </div>
</div>

<!-- ğŸ´ æŠ½å¡è®­ç»ƒ -->
<div class="container">

  <!-- å…ƒç´ å¡ -->
  <div class="card">
      <div class="section-title">â‘  æŠ½å–ä»Šæ—¥æ€ç»´å…ƒç´ å¡</div>
      <button style="width:auto; padding:10px 20px; border-radius:12px;"
              onclick="drawElementCard()">
          æŠ½å…ƒç´ å¡
      </button>

      <div class="flip-card" id="elementFlip">
          <div class="flip-card-inner">
              <div class="flip-front" style="text-align:center; color:var(--text-sub);">
                  ğŸ¸ ç‚¹å‡»ã€ŒæŠ½å…ƒç´ å¡ã€æŸ¥çœ‹ä»Šæ—¥æç¤º
              </div>
              <div class="flip-back" style="line-height:1.6;">
                  <p id="elementCard" style="white-space:pre-wrap; margin:0;"></p>
              </div>
          </div>
      </div>

      <textarea id="elementAnswer"
                placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•ã€æ¨ç†æˆ–è§‚å¯Ÿâ€¦"></textarea>
  </div>

  <!-- æ ‡å‡†å¡ -->
  <div class="card">
      <div class="section-title">â‘¡ æŠ½å–ä»Šæ—¥æ€ç»´æ ‡å‡†å¡</div>
      <button style="width:auto; padding:10px 20px; border-radius:12px;"
              onclick="drawStandardCard()">
          æŠ½æ ‡å‡†å¡
      </button>

      <div class="flip-card" id="standardFlip">
          <div class="flip-card-inner">
              <div class="flip-front" style="text-align:center; color:var(--text-sub);">
                  ğŸ¸ ç‚¹å‡»ã€ŒæŠ½æ ‡å‡†å¡ã€
              </div>
              <div class="flip-back" style="line-height:1.6;">
                  <p id="standardCard" style="white-space:pre-wrap; margin:0;"></p>
              </div>
          </div>
      </div>

      <div class="section-title" style="margin-top:18px;">ä¸ºè¯¥æ ‡å‡†æ‰“åˆ†ï¼ˆ1â€“3 åˆ†ï¼‰</div>
      <select id="standardScore">
          <option value="1">1 åˆ†</option>
          <option value="2">2 åˆ†</option>
          <option value="3">3 åˆ†</option>
      </select>

      <div class="section-title">è¯šå®åº¦æ‰“åˆ†ï¼ˆ1â€“3 åˆ†ï¼‰</div>
      <select id="honestyScore">
          <option value="1">1 åˆ†</option>
          <option value="2">2 åˆ†</option>
          <option value="3">3 åˆ†</option>
      </select>
  </div>

  <button onclick="saveToday()" style="margin-top:10px; width:100%; border-radius:12px;">
      ä¿å­˜ä»Šæ—¥è®°å½•
  </button>

</div>

<!-- ğŸ“ å†å²è®°å½• -->
<div class="container">
<div class="card" onclick="toggleHistory()" style="cursor:pointer;">
    <div class="master-header">
        <div class="master-icon">ğŸ“</div>
        <div class="master-title">æˆ‘çš„æ€ç»´è®°å½•ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</div>
        <div class="master-arrow" id="history-arrow">â–¼</div>
    </div>
    <div id="history-content" class="master-content">
        <div id="history-list"></div>
    </div>
</div>
</div>

<!-- ğŸ“… æ¯å‘¨æˆé•¿æŠ¥å‘Š -->
<div class="container">
<div class="card" onclick="toggleWeeklyReport()" style="cursor:pointer;">
    <div class="master-header">
        <div class="master-icon">ğŸ“…</div>
        <div class="master-title">æ¯å‘¨æ€ç»´æˆé•¿æŠ¥å‘Šï¼ˆç‚¹å‡»å±•å¼€ï¼‰</div>
        <div class="master-arrow" id="weekly-arrow">â–¼</div>
    </div>
    <div id="weekly-report-content" class="master-content">
        <div id="weekly-report-box"
             style="background:rgba(255,255,255,0.7); padding:20px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,0.08); line-height:1.7;">
        </div>
    </div>
</div>
</div>

<!-- âœ¨ æ€ç»´å…«è¦ç´ åŠ¨ç”» -->
<div class="container">
<div class="card">
    <div class="section-title">âœ¨ å¤§å¸ˆæ€ç»´åŠ¨ç”»ï¼ˆå…«è¦ç´ æµåŠ¨ï¼‰</div>
    <div class="thinking-flow">
        <div id="step-purpose" class="thinking-step">ç›®çš„</div>
        <div id="step-question" class="thinking-step">é—®é¢˜</div>
        <div id="step-info" class="thinking-step">ä¿¡æ¯</div>
        <div id="step-concept" class="thinking-step">æ¦‚å¿µ</div>
        <div id="step-assumption" class="thinking-step">å‡è®¾</div>
        <div id="step-inference" class="thinking-step">æ¨è®º</div>
        <div id="step-view" class="thinking-step">è§†è§’</div>
        <div id="step-impact" class="thinking-step">åæœ</div>
    </div>
</div>
</div>

<!-- ğŸ“Š å›¾è¡¨ -->
<div class="container">
  <div class="card">
      <div class="section-title">ğŸ“Š æ€ç»´è¦ç´ ç»ƒä¹ è¦†ç›–åº¦ï¼ˆé›·è¾¾å›¾ï¼‰</div>
      <canvas id="elementRadar"></canvas>
  </div>
  <div class="card">
      <div class="section-title">ğŸ“Š æ€ç»´æ ‡å‡†å¹³å‡åˆ†ï¼ˆé›·è¾¾å›¾ï¼‰</div>
      <canvas id="standardRadar"></canvas>
  </div>
  <div class="card">
      <div class="section-title">ğŸ“ˆ æ€ç»´é˜¶æ®µè¶‹åŠ¿ï¼ˆæŠ˜çº¿å›¾ï¼‰</div>
      <canvas id="stageTrend"></canvas>
      <button onclick="showWeekly()" style="margin-top:10px;">åˆ·æ–°ç»Ÿè®¡ & å›¾è¡¨</button>
      <pre id="weeklyStats" style="margin-top:10px; white-space:pre-wrap; font-size:14px; color:var(--text-sub);"></pre>
  </div>
</div>

<!-- ğŸ¸ äº”å¤§å¤§å¸ˆå¡ç‰‡ -->
<div class="container">
<div class="master-card" onclick="toggleMasterBeautiful('conflict')">
    <div class="master-header">
        <div class="master-icon">ğŸ¸</div>
        <div class="master-title">å¤§å¸ˆç¤ºèŒƒï¼šå¦‚ä½•ä¼˜é›…å¤„ç†å†²çªï¼Ÿ</div>
        <div class="master-arrow" id="arrow-conflict">â–¼</div>
    </div>
    <div id="content-conflict" class="master-content">
        <div class="master-section-title">âœ¨ é»„é‡‘åŸåˆ™</div>
        <div class="master-pill">å…ˆç†è§£ï¼Œå†å›åº”</div>
        <div class="master-pill">å†²çª = éœ€æ±‚æœªè¢«çœ‹è§</div>
        <div class="master-pill">ä¸æ˜¯è°å¯¹è°é”™ï¼Œè€Œæ˜¯â€œç°å®æ˜¯ä»€ä¹ˆâ€</div>
        <div class="master-summary">
            ğŸŒˆ å¤§å¸ˆæ€»ç»“ï¼šå†²çªæ˜¯çœ‹è§å½¼æ­¤ã€è€Œä¸æ˜¯å‡»è´¥å½¼æ­¤ã€‚
        </div>
    </div>
</div>
</div>

<script>
/* æŠ½å¡æ•°æ® */
const elementCards = [
    {key:"ç›®çš„", text:"ã€ç›®çš„å¡ã€‘ä»Šå¤©ä½ çœŸæ­£çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿè¡¨é¢ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ"},
    {key:"é—®é¢˜", text:"ã€é—®é¢˜å¡ã€‘æŠŠä½ çº ç»“çš„ä¸€ä»¶äº‹æ”¹å†™æˆä¸€ä¸ªæ¸…æ™°çš„é—®é¢˜å¥ã€‚"},
    {key:"ä¿¡æ¯", text:"ã€ä¿¡æ¯å¡ã€‘å†™å‡º 3 æ¡äº‹å® + 3 æ¡æ¨æµ‹ï¼Œå¹¶æ ‡æ¸…ã€‚"},
    {key:"æ¦‚å¿µ", text:"ã€æ¦‚å¿µå¡ã€‘å†™ä¸‹ä½ å¯¹ä¸€ä¸ªæŠ½è±¡è¯çš„å®šä¹‰ï¼Œå¦‚è‡ªç”±/å®‰å…¨/æˆå°±ã€‚"},
    {key:"æ¨è®º", text:"ã€æ¨è®ºå¡ã€‘å†™å‡ºä¸€ä¸ªä½ çš„ç»“è®ºå’Œ 2â€“3 æ¡ç†ç”±ã€‚"},
    {key:"å‡è®¾", text:"ã€å‡è®¾å¡ã€‘å†™ä¸‹ä½ æ­£åœ¨é»˜è®¤æˆç«‹çš„ä¸œè¥¿ï¼šå¦‚æœå®ƒæ˜¯é”™çš„å‘¢ï¼Ÿ"},
    {key:"è§†è§’", text:"ã€è§†è§’å¡ã€‘ç”¨å¯¹ç«‹ç«‹åœºå†™ 2 å¥è¯çœ‹è¿™ä»¶äº‹ã€‚"},
    {key:"åæœ", text:"ã€åæœå¡ã€‘å†™å‡ºä¸€ä¸ªå†³å®šçš„çŸ­æœŸåæœ + é•¿æœŸåæœã€‚"}
];
const standardCards = [
    {key:"æ¸…æ™°", text:"ã€æ¸…æ™°å¡ã€‘ä½ çš„è¡¨è¾¾æ˜¯å¦å®¹æ˜“ç†è§£ï¼Ÿ"},
    {key:"å‡†ç¡®", text:"ã€å‡†ç¡®å¡ã€‘å“ªäº›æ˜¯äº‹å®ï¼Ÿå“ªäº›å¯èƒ½é”™è¯¯ï¼Ÿ"},
    {key:"ç²¾ç¡®", text:"ã€ç²¾ç¡®å¡ã€‘å¯ä»¥æ›´å…·ä½“å—ï¼Ÿæ•°å­—/ä¾‹å­ï¼Ÿ"},
    {key:"ç›¸å…³", text:"ã€ç›¸å…³å¡ã€‘ä½ å†™çš„æ¯ä¸€å¥è¯éƒ½åœ¨è§£å†³åŒä¸€ä¸ªæ ¸å¿ƒé—®é¢˜å—ï¼Ÿ"},
    {key:"æ·±åˆ»", text:"ã€æ·±åˆ»å¡ã€‘ä½ æ˜¯å¦è§¦åŠæ›´æ·±ä¸€å±‚çš„åŸå› ï¼Ÿ"},
    {key:"å¹¿åº¦", text:"ã€å¹¿åº¦å¡ã€‘ä»åæ–¹è§’åº¦ï¼Œä¼šæœ‰ä»€ä¹ˆæ–°çœ‹æ³•ï¼Ÿ"},
    {key:"é€»è¾‘", text:"ã€é€»è¾‘å¡ã€‘ç†ç”±æ˜¯å¦çœŸçš„æ”¯æ’‘ä½ çš„ç»“è®ºï¼Ÿ"},
    {key:"é‡è¦æ€§", text:"ã€é‡è¦æ€§å¡ã€‘ä½ å…³æ³¨çš„æ˜¯è¿™ä»¶äº‹æœ€é‡è¦çš„éƒ¨åˆ†å—ï¼Ÿ"},
    {key:"å…¬æ­£", text:"ã€å…¬æ­£å¡ã€‘ä½ æ˜¯å¦å¯¹è‡ªå·±å’Œä»–äººä½¿ç”¨åŒä¸€æ ‡å‡†ï¼Ÿ"}
];

function drawElementCard() {
    const card = elementCards[Math.floor(Math.random()*elementCards.length)];
    document.getElementById("elementCard").innerText = card.text;
    localStorage.setItem("today_element", JSON.stringify(card));
    const flip = document.getElementById("elementFlip");
    flip.classList.add("flip");
}
function drawStandardCard() {
    const card = standardCards[Math.floor(Math.random()*standardCards.length)];
    document.getElementById("standardCard").innerText = card.text;
    localStorage.setItem("today_standard", JSON.stringify(card));
    const flip = document.getElementById("standardFlip");
    flip.classList.add("flip");
}

/* ç­‰çº§ç³»ç»Ÿ */
const LEVELS = [
    { level: 1, name: "æ€ç»´èŒèŠ½ Seedling", min: 0, max: 99, percentile: 20 },
    { level: 2, name: "æ€ç»´è§‚å¯Ÿè€… Observer", min: 100, max: 249, percentile: 35 },
    { level: 3, name: "æ€ç»´æ¢ç´¢è€… Explorer", min: 250, max: 499, percentile: 50 },
    { level: 4, name: "æ€ç»´å®è·µè€… Practitioner", min: 500, max: 899, percentile: 70 },
    { level: 5, name: "æ€ç»´ç­–å£« Strategist", min: 900, max: 1499, percentile: 85 },
    { level: 6, name: "æ€ç»´é©¾é©­è€… Navigator", min: 1500, max: 2499, percentile: 95 },
    { level: 7, name: "æ€ç»´å¤§å¸ˆ Master", min: 2500, max: 999999, percentile: 99 }
];
function calculateEXP(r){ return (r.standardScore + r.honestyScore) * 5; }
function getTotalEXP(logs){ return logs.reduce((s,r)=>s+calculateEXP(r),0); }
function getLevel(total){ return LEVELS.find(l=> total>=l.min && total<=l.max ); }
function getNextEXP(level){ return level.level===7 ? level.max : LEVELS[level.level].min; }
function updateLevelUI(){
    const logs = JSON.parse(localStorage.getItem("logs") || "[]");
    const total = getTotalEXP(logs);
    const lv = getLevel(total);
    if(!lv) return;
    const next = getNextEXP(lv);
    const pct = Math.min((total - lv.min) / (next - lv.min), 1) * 100;
    document.getElementById("level-title").innerText = `ç­‰çº§ Lv.${lv.level}ï¼š${lv.name}`;
    document.getElementById("level-exp-text").innerText = `ç§¯åˆ†ï¼š${total} / ${next}`;
    document.getElementById("progress-bar").style.width = pct + "%";
    document.getElementById("percentile-text").innerText =
        `ä½ è¶…è¿‡äº†å…¨çƒ ${lv.percentile}% çš„äººç±»`;
}

/* ä¿å­˜è®°å½• */
function saveToday(){
    const e = JSON.parse(localStorage.getItem("today_element"));
    const s = JSON.parse(localStorage.getItem("today_standard"));
    if(!e || !s){
        alert("è¯·å…ˆæŠ½å…ƒç´ å¡å’Œæ ‡å‡†å¡ï¼");
        return;
    }
    const text = document.getElementById("elementAnswer").value.trim();
    const record = {
        date: new Date().toISOString().slice(0,10),
        element: e.key,
        standard: s.key,
        text: text,
        standardScore: parseInt(document.getElementById("standardScore").value),
        honestyScore: parseInt(document.getElementById("honestyScore").value)
    };
    let logs = JSON.parse(localStorage.getItem("logs") || "[]");
    logs.push(record);
    localStorage.setItem("logs", JSON.stringify(logs));
    alert("ä»Šæ—¥è®°å½•å·²ä¿å­˜ï¼");
    updateLevelUI();
}

/* å†å²è®°å½• */
function toggleHistory(){
    const box = document.getElementById("history-content");
    const arrow = document.getElementById("history-arrow");
    const open = box.style.display === "block";
    box.style.display = open ? "none" : "block";
    arrow.style.transform = open ? "rotate(0deg)" : "rotate(180deg)";
    if (!open) renderHistory();
}
function renderHistory(){
    const container = document.getElementById("history-list");
    let logs = JSON.parse(localStorage.getItem("logs") || "[]");
    if(!logs.length){
        container.innerHTML = "<div style='padding:10px;color:#64748b;'>æš‚æ— è®°å½• ğŸ¸</div>";
        return;
    }
    logs = logs.sort((a,b)=> new Date(b.date) - new Date(a.date));
    let html = "";
    logs.forEach((r,i)=>{
        html += `
        <div class="card" style="margin-top:12px; cursor:pointer;" onclick="toggleHistoryDetail(${i})">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <div style="font-size:15px;font-weight:600;color:var(--green-deep);">ğŸ¸ ${r.date}</div>
                <div id="arrow-h${i}" style="font-size:18px;">â–¼</div>
            </div>
            <div style="font-size:14px;color:var(--text-sub);margin-top:6px;">
                å…ƒç´ å¡ï¼š${r.element} | æ ‡å‡†å¡ï¼š${r.standard}
            </div>
            <div id="history-detail-${i}" style="
                display:none;
                margin-top:14px;
                padding:12px;
                background:#f0fdf4;
                border-radius:12px;
                color:#166534;
                line-height:1.6;">
                ${r.text ? r.text.replace(/\n/g,"<br>") : ""}
            </div>
        </div>`;
    });
    container.innerHTML = html;
}
function toggleHistoryDetail(i){
    const d = document.getElementById("history-detail-"+i);
    const arrow = document.getElementById("arrow-h"+i);
    const open = d.style.display === "block";
    d.style.display = open ? "none" : "block";
    arrow.style.transform = open ? "rotate(0deg)" : "rotate(180deg)";
}

/* å‘¨æŠ¥ */
function toggleWeeklyReport(){
    const box = document.getElementById("weekly-report-content");
    const arrow = document.getElementById("weekly-arrow");
    const open = box.style.display === "block";
    box.style.display = open ? "none" : "block";
    arrow.style.transform = open ? "rotate(0deg)" : "rotate(180deg)";
    if (!open) generateWeeklyReport();
}
function generateWeeklyReport(){
    const logs = JSON.parse(localStorage.getItem("logs") || "[]");
    const now = Date.now();
    const oneWeek = 7 * 24 * 3600 * 1000;
    const weekLogs = logs.filter(r => now - new Date(r.date).getTime() < oneWeek);
    const box = document.getElementById("weekly-report-box");
    if (!weekLogs.length){
        box.innerHTML = "æœ¬å‘¨æ²¡æœ‰è®°å½• ğŸ¸<br>å†™ä¸€æ¡è®°å½•åï¼Œè¿™é‡Œä¼šç”Ÿæˆä½ çš„æ€ç»´æˆé•¿æŠ¥å‘Šã€‚";
        return;
    }
    const count = weekLogs.length;
    const avgScore = (
        weekLogs.reduce((s,r)=> s + r.standardScore + r.honestyScore ,0)
        / count
    ).toFixed(2);
    const stats = {};
    weekLogs.forEach(r=>{
        stats[r.element] = (stats[r.element]||0)+1;
    });
    const best = Object.keys(stats).sort((a,b)=> stats[b]-stats[a])[0];
    const weak = Object.keys(stats).sort((a,b)=> stats[a]-stats[b])[0];
    box.innerHTML = `
        <b>ğŸ¸ æœ¬å‘¨è®°å½•æ¬¡æ•°ï¼š</b> ${count} æ¬¡<br>
        <b>â­ å¹³å‡æ€ç»´å¾—åˆ†ï¼š</b> ${avgScore}<br>
        <b>ğŸ¯ æœ€å¸¸ç»ƒä¹ è¦ç´ ï¼š</b> ${best}<br>
        <b>ğŸª© æœ€å°‘ç»ƒä¹ è¦ç´ ï¼š</b> ${weak}<br><br>
        <b>ğŸ¸ å¤§å¸ˆå»ºè®®ï¼š</b><br>
        <div style="background:#f0fdf4;padding:12px;border-radius:12px;color:#166534;">
            ${
                weak === "å‡è®¾"
                ? "æœ¬å‘¨å¯ä»¥å¤šç»ƒä¹ â€œæ‰¾éšè—å‡è®¾â€ï¼Œé—®é—®è‡ªå·±ï¼šå¦‚æœè¿™ä¸ªé»˜è®¤è®¾å®šæ˜¯é”™çš„å‘¢ï¼Ÿ"
                : weak === "ä¿¡æ¯"
                ? "è¯•ç€å¤šåŒºåˆ†â€œäº‹å® vs æ¨æµ‹â€ï¼Œè®©ä½ çš„æ¨ç†æ›´æ‰å®ã€‚"
                : "ä½ çš„è¡¨ç°éå¸¸ç¨³å®šï¼ŒåšæŒæ¯å¤©ä¸€ç‚¹ç‚¹å°±æ˜¯æˆé•¿ ğŸ¸âœ¨"
            }
        </div>
    `;
}

/* æ€ç»´åŠ¨ç”» */
let stepsFlow = ["purpose","question","info","concept","assumption","inference","view","impact"];
let idx = 0;
setInterval(()=>{
    stepsFlow.forEach(id =>{
        const el = document.getElementById("step-"+id);
        if(el) el.classList.remove("active");
    });
    const curr = document.getElementById("step-"+stepsFlow[idx]);
    if(curr) curr.classList.add("active");
    idx = (idx+1)%stepsFlow.length;
}, 1800);

/* å¤§å¸ˆå¡æŠ˜å  */
function toggleMasterBeautiful(id){
    const content = document.getElementById("content-"+id);
    const arrow = document.getElementById("arrow-"+id);
    const open = content.style.display === "block";
    content.style.display = open ? "none" : "block";
    arrow.style.transform = open ? "rotate(0deg)" : "rotate(180deg)";
}

/* å›¾è¡¨ */
function calcElementFrequency(logs){
    const keys = ["ç›®çš„","é—®é¢˜","ä¿¡æ¯","æ¦‚å¿µ","æ¨è®º","å‡è®¾","è§†è§’","åæœ"];
    return {
        labels: keys,
        data: keys.map(k => logs.filter(r=>r.element===k).length)
    };
}
function calcStandardScores(logs){
    const keys = ["æ¸…æ™°","å‡†ç¡®","ç²¾ç¡®","ç›¸å…³","æ·±åˆ»","å¹¿åº¦","é€»è¾‘","é‡è¦æ€§","å…¬æ­£"];
    return {
        labels: keys,
        data: keys.map(k =>{
            const arr = logs.filter(r=>r.standard===k);
            if(!arr.length) return 0;
            return arr.reduce((a,b)=>a+b.standardScore,0) / arr.length;
        })
    };
}
function calcStageTrend(logs){
    logs = [...logs].sort((a,b)=> new Date(a.date)-new Date(b.date));
    return {
        labels: logs.map(r=>r.date),
        values: logs.map(r=>{
            const sc = (r.standardScore + r.honestyScore)/2;
            if(sc < 2) return 1;
            if(sc < 2.5) return 2;
            return 3;
        })
    };
}
let elementRadarChart, standardRadarChart, stageTrendChart;
function renderCharts(logs){
    const element = calcElementFrequency(logs);
    const std = calcStandardScores(logs);
    const trend = calcStageTrend(logs);

    if(elementRadarChart) elementRadarChart.destroy();
    if(standardRadarChart) standardRadarChart.destroy();
    if(stageTrendChart) stageTrendChart.destroy();

    if(document.getElementById("elementRadar")){
        elementRadarChart = new Chart(
            document.getElementById("elementRadar"),
            {
                type:'radar',
                data:{
                    labels: element.labels,
                    datasets:[{
                        label:"ç»ƒä¹ æ¬¡æ•°",
                        data: element.data,
                        borderColor:"#22c55e",
                        backgroundColor:"rgba(34,197,94,0.2)"
                    }]
                }
            }
        );
    }
    if(document.getElementById("standardRadar")){
        standardRadarChart = new Chart(
            document.getElementById("standardRadar"),
            {
                type:'radar',
                data:{
                    labels: std.labels,
                    datasets:[{
                        label:"å¹³å‡åˆ†",
                        data: std.data,
                        borderColor:"#3b82f6",
                        backgroundColor:"rgba(59,130,246,0.2)"
                    }]
                }
            }
        );
    }
    if(document.getElementById("stageTrend")){
        stageTrendChart = new Chart(
            document.getElementById("stageTrend"),
            {
                type:'line',
                data:{
                    labels: trend.labels,
                    datasets:[{
                        label:"é˜¶æ®µè¶‹åŠ¿ (1=æŒ£æ‰/2=åˆå­¦/3=ç»ƒä¹ )",
                        data: trend.values,
                        borderColor:"#f97316",
                        tension:0.35,
                        pointRadius:3
                    }]
                },
                options:{
                    scales:{ y:{min:1,max:3,ticks:{stepSize:1}} }
                }
            }
        );
    }
}
function showWeekly(){
    const logs = JSON.parse(localStorage.getItem("logs") || "[]");
    renderCharts(logs);
    const now = Date.now();
    const oneWeek = 7*24*3600*1000;
    const weekLogs = logs.filter(r=> now - new Date(r.date).getTime() < oneWeek);
    const el = document.getElementById("weeklyStats");
    if(!el) return;
    if(!weekLogs.length){
        el.innerText = "æœ¬å‘¨æš‚æ— è®°å½• ğŸ¸";
        return;
    }
    const avg = (arr,key)=> arr.reduce((s,r)=>s+r[key],0) / arr.length;
    el.innerText =
        `æœ¬å‘¨ç»ƒä¹ æ¬¡æ•°ï¼š${weekLogs.length}\n` +
        `å¹³å‡æ ‡å‡†å¾—åˆ†ï¼š${avg(weekLogs,"standardScore").toFixed(2)}\n` +
        `å¹³å‡è¯šå®åº¦ï¼š${avg(weekLogs,"honestyScore").toFixed(2)}\n` +
        `è¦†ç›–è¦ç´ ï¼š${[...new Set(weekLogs.map(r=>r.element))].join("ï¼Œ")}\n` +
        `è¦†ç›–æ ‡å‡†ï¼š${[...new Set(weekLogs.map(r=>r.standard))].join("ï¼Œ")}`;
}

/* åˆå§‹åŒ– */
(function init(){
    updateLevelUI();
    const logs = JSON.parse(localStorage.getItem("logs") || "[]");
    if(logs.length){
        renderCharts(logs);
    }
})();
</script>

</body>
</html>
